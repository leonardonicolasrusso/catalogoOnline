<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cat√°logo de Controles</title>
  <style>
    :root{
      --bg:#f5f6f8; --ink:#111; --muted:#6b7280; --card:#fff;
      --radius:14px; --shadow:0 6px 18px rgba(0,0,0,.08);
      --accent:#0ea5e9;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;background:var(--bg);color:var(--ink)}

    header{
      position:sticky;top:0;z-index:5;
      background:rgba(255,255,255,.7);backdrop-filter:blur(6px);
      border-bottom:1px solid #e5e7eb;
      padding:22px 12px 12px;
      text-align:center;
    }
    h1{margin:0;font-size:clamp(22px,3.5vw,32px)}
    .sub{color:var(--muted);font-size:14px;margin-top:6px}

    /* CATEGOR√çAS (segmented) */
    .cats{
      margin:10px auto 6px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;
      padding:0 12px;
    }
    .cat-btn{
      appearance:none;background:#fff;border:1px solid #e5e7eb;color:#111;
      padding:8px 12px;border-radius:999px;font-weight:700;cursor:pointer;
    }
    .cat-btn.active{ background:var(--accent); color:#fff; border-color:transparent }

    main{max-width:1400px;margin:auto;padding:18px}

    /* GRID */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(200px,1fr));
      gap:18px;
    }
    @media (max-width: 600px) {
      .grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
    }
    .card{
      background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:12px;text-align:center;cursor:pointer;transition:transform .15s ease
    }
    .card:hover{transform:translateY(-3px)}
    .card img{
      width:100%;
      aspect-ratio:1/1;
      object-fit:contain;
      background:#f1f3f5;
      border-radius:12px;
    }
    .name{margin-top:8px;font-weight:700;text-transform:uppercase;font-size:14px}

    /* Sentinel (infinite scroll) */
    #sentinel{ height:1px; }
    .loading-note{ text-align:center; color:var(--muted); font-size:13px; margin-top:10px; }

    /* ===== MODAL DETALLE (simple) ===== */
    #detailModal{
      display:none; position:fixed; inset:0; z-index:2000;
      background:rgba(0,0,0,.85);
      justify-content:center; align-items:center; padding:20px;
    }
    .modal-card{
      width:min(950px, 96vw);
      background:#fff; border-radius:18px; box-shadow:var(--shadow);
      padding:18px; display:grid; gap:16px; grid-template-columns: 1.1fr 1fr;
      max-height: 92vh; overflow:auto;
    }
    @media (max-width: 860px){
      .modal-card{ grid-template-columns:1fr; }
    }
    #modalImg{
      width:100%; aspect-ratio:1/1; object-fit:contain; background:#f1f3f5; border-radius:14px;
    }
    .modal-title{ margin:0; text-transform:uppercase; }
    .muted{ color:var(--muted); }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .btn{appearance:none;border:1px solid #e5e7eb;background:#fff;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border-color:transparent}
    .center{ display:flex; justify-content:center; margin-top:6px; }
    .toast{ font-size:13px; color:#059669; display:none; margin-top:6px; }

    /* Bot√≥n cerrar ‚Äúabajo‚Äù */
    .modal-actions{
      grid-column: 1 / -1;
      display:flex; flex-direction:column; align-items:center;
    }
  </style>
</head>
<body>
  <header>
    <h1>CAT√ÅLOGO DE CONTROLES</h1>
    <div class="sub">Usa las categor√≠as para filtrar. Toca un control para verlo.</div>

    <!-- BOTONES DE CATEGOR√çA -->
    <div class="cats" id="catBar">
      <button class="cat-btn active" data-cat="lcd">LCD / SMART TV</button>
      <button class="cat-btn" data-cat="box">TV BOX</button>
      <button class="cat-btn" data-cat="universal">UNIVERSAL</button>
      <button class="cat-btn" data-cat="aire">AIRE ACOND.</button>
    </div>
  </header>

  <main>
    <!-- GRID -->
    <section id="grid" class="grid" aria-live="polite"></section>
    <div id="sentinel" aria-hidden="true"></div>
    <div id="loadingNote" class="loading-note" style="display:none;">Cargando m√°s‚Ä¶</div>
  </main>

  <!-- MODAL DETALLE -->
  <div id="detailModal" role="dialog" aria-modal="true" aria-label="Detalle del control">
    <div class="modal-card" id="modalCard">
      <img id="modalImg" alt="Control remoto" />
      <div>
        <h2 id="modalName" class="modal-title">LCD 000</h2>
        <p class="muted">Vista r√°pida. Pod√©s compartir la imagen con vista previa en WhatsApp.</p>
        <div class="row">
          <button id="modalShare" class="btn primary">Compartir imagen</button>
        </div>
        <div id="modalToast" class="toast">¬°Listo!</div>
      </div>

      <div class="modal-actions">
        <button id="modalClose" class="btn">‚úñ Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    /* ================== CONFIG CATEGOR√çAS ================== */
    const EXT = '.png';
    const CATEGORIES = {
      lcd: {
        label: 'LCD / SMART TV',
        path: 'img/lcd/',
        items: [
          132,133,401,403,405,406,407,408,409,410,411,412,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,"448","448TH",449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,"467JV",468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,"498","498TH","498TH2",499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,"553P",554,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,638,639,640,641,642,643,644,645,646,649,654,656,657,658
        ],
        displayName: id => `LCD ${id}`
      },
      box: {
        label: 'TV BOX',
        path: 'img/box/',
        items: ['TvBox1', 'TvBox2'], // reemplaz√° por los tuyos
        displayName: id => String(id)
      },
      universal: {
        label: 'UNIVERSAL',
        path: 'img/universal/',
        items: ['aireUniversal'], // reemplaz√° por tu nombre real
        displayName: id => String(id)
      },
      aire: {
        label: 'AIRE ACOND.',
        path: 'img/aire/',
        items: [800,801,802,803,804,805,806,807,808,809,810,811,812,813,814,815,816,817,818,819,820,821,822,823,824,825,826,827,828,829,830,831,832,833,834,835,836,837,838,839,840,841,842,843,844,845,846,847,848,849,850,851,852,853,854,855,856,857,858,859,860,861,862,863,864,865,866,867,868,869,870,871,872,873,874,875,876,877,878,879,880,881,882,883,884,885,886,887,889,890,891,892,893,895],
        displayName: id => `AR ${id}`
      }
    };

    /* ================== REFERENCIAS DOM ================== */
    const gridEl     = document.getElementById('grid');
    const sentinel   = document.getElementById('sentinel');
    const loadingNote= document.getElementById('loadingNote');
    const catBar     = document.getElementById('catBar');

    // Modal
    const detailModal= document.getElementById('detailModal');
    const modalCard  = document.getElementById('modalCard');
    const modalImg   = document.getElementById('modalImg');
    const modalName  = document.getElementById('modalName');
    const modalShare = document.getElementById('modalShare');
    const modalClose = document.getElementById('modalClose');
    const modalToast = document.getElementById('modalToast');

    /* ================== ESTADO ================== */
    let currentCatKey = 'lcd';
    let SOURCE_LIST   = [];
    const PAGE_SIZE   = 24;
    let page = 0, loading = false, observer = null;

    /* ================== UTILIDADES ================== */
    function srcFor(id){
      const cat = CATEGORIES[currentCatKey];
      return `${cat.path}${id}${EXT}`;
    }
    function nameFor(id){ return CATEGORIES[currentCatKey].displayName(id); }

    function setActiveCatButton(){
      catBar.querySelectorAll('.cat-btn').forEach(b=>{
        b.classList.toggle('active', b.dataset.cat === currentCatKey);
      });
    }

    /* ================== RENDER GRID (infinite) ================== */
    function createCard(id){
      const card = document.createElement('article');
      card.className = 'card';
      const display = nameFor(id);
      const src = srcFor(id);
      card.innerHTML = `
        <img src="${src}" alt="${display}" loading="lazy">
        <div class="name">${display}</div>
      `;
      card.addEventListener('click', () => openModal(id));
      return card;
    }

    function appendBatch(){
      if (loading) return;
      loading = true; loadingNote.style.display = 'block';

      const start = page * PAGE_SIZE;
      const end   = Math.min(start + PAGE_SIZE, SOURCE_LIST.length);

      if (start >= SOURCE_LIST.length) {
        loadingNote.style.display = 'none';
        disconnectObserver();
        loading = false;
        return;
      }
      for (let i = start; i < end; i++){
        gridEl.appendChild(createCard(SOURCE_LIST[i]));
      }
      page++;
      loading = false; loadingNote.style.display = 'none';

      if (page * PAGE_SIZE >= SOURCE_LIST.length){
        disconnectObserver();
      }
      fillViewportIfNeeded();
    }

    function fillViewportIfNeeded(){
      if (detailModal.style.display === 'flex') return;
      if (document.documentElement.scrollHeight <= window.innerHeight + 50) {
        requestAnimationFrame(()=> appendBatch());
      }
    }

    function disconnectObserver(){ if (observer){ observer.disconnect(); observer=null; } }
    function setupObserver(){
      disconnectObserver();
      observer = new IntersectionObserver((entries)=>{
        const entry = entries[0];
        if (entry.isIntersecting && detailModal.style.display !== 'flex'){
          appendBatch();
        }
      }, { root:null, rootMargin:'800px 0px', threshold:0 });
      observer.observe(sentinel);
    }

    function renderGridInitial(){
      gridEl.innerHTML = '';
      page = 0; loading = false;
      appendBatch(); // primer lote
      appendBatch(); // segundo lote para llenar
      setupObserver();
      fillViewportIfNeeded();
    }

    /* ================== CAMBIO DE CATEGOR√çA ================== */
    function setCategory(catKey){
      if (!CATEGORIES[catKey]) return;
      currentCatKey = catKey;
      SOURCE_LIST = [...CATEGORIES[currentCatKey].items];
      setActiveCatButton();
      renderGridInitial();
    }

    catBar.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-cat]');
      if (!btn) return;
      const k = btn.dataset.cat;
      if (k === currentCatKey) return;
      setCategory(k);
    });

    /* ================== MODAL DETALLE ================== */
    function openModal(id){
      const src  = srcFor(id);
      const name = nameFor(id);
      const imgUrl = new URL(src, location.href).href;

      modalImg.src = src;
      modalImg.alt = name;
      modalName.textContent = name;
      modalToast.style.display = 'none';

      modalShare.onclick = async () => {
        const shareData = { title: name, text: `Mir√° este control: ${name}`, url: imgUrl };
        try {
          if (navigator.share) {
            await navigator.share(shareData);
            modalToast.textContent = '‚úÖ Compartido';
          } else {
            await navigator.clipboard.writeText(imgUrl);
            modalToast.textContent = 'üîó Link de la imagen copiado';
          }
          modalToast.style.display = 'block';
          setTimeout(()=> modalToast.style.display = 'none', 1800);
        } catch (err) { console.log('Cancelado o error al compartir:', err); }
      };

      detailModal.style.display = 'flex';
      disconnectObserver(); // pausa el infinite scroll mientras est√° abierto
    }

    function closeModal(){
      detailModal.style.display = 'none';
      setupObserver();         // reanuda
      fillViewportIfNeeded();
    }

    // Cierre: bot√≥n, click fuera, ESC
    modalClose.addEventListener('click', closeModal);
    detailModal.addEventListener('click', (e)=>{ if(e.target === detailModal) closeModal(); });
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && detailModal.style.display === 'flex') closeModal(); });

    window.addEventListener('resize', ()=>{ if (detailModal.style.display !== 'flex') fillViewportIfNeeded(); });

    /* ================== INIT ================== */
    function boot(){
      SOURCE_LIST = [...CATEGORIES[currentCatKey].items];
      setActiveCatButton();
      renderGridInitial();
    }
    boot();
  </script>
</body>
</html>
